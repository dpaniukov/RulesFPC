require(lme4)

# We've got rules per run from ipython notebook. Here they are:
mat_rules=c(3.25, 5.0, 5.0, 5.25, 3.75, 3.5, 4.0, 3.75, 4.333333333333333, 3.5, 5.0, 5.25, 4.0, 4.75, 4.25, 3.75, 2.25, 4.25, 1.75, 1.25, 5.25, 4.0, 4.75, 3.5, 4.5)
cat_rules=c(3.25, 2.25, 2.75, 2.5, 3.0, 2.5, 2.5, 3.25, 2.75, 2.0, 2.75, 1.75, 3.25, 4.0, 2.25, 1.5, 1.5, 2.3333333333333335, 3.25, 0.75, 3.25, 3.5, 3.0, 1.25, 3.25)

# Now, let's make one step back and convert them to rules per subject.
# Note: Subjects 3,11,16,19, and 20 had less than 4 runs per task.
# The reason for the step back is that Piosson is not possible on non-integers.
mat_rules_subj=c(3.25*4, 5.0*4, 5.0*3, 5.25*4, 3.75*4, 3.5*4, 4.0*4, 3.75*4, round(4.333333333333333*3), 3.5*4, 5.0*4, 5.25*4, 4.0*4, 4.75*4, 4.25*4, 3.75*4, 2.25*4, 4.25*4, 1.75*4, 1.25*4, 5.25*4, 4.0*4, 4.75*4, 3.5*4, 4.5*4)
cat_rules_subj=c(3.25*4, 2.25*4, 2.75*4, 2.5*4, 3.0*4, 2.5*4, 2.5*4, 3.25*4, 2.75*4, 2.0*4, 2.75*4, 1.75*4, 3.25*4, 4.0*3, 2.25*4, 1.5*4, 1.5*2, round(2.3333333333333335*3), 3.25*4, 0.75*4, 3.25*4, 3.5*4, 3.0*4, 1.25*4, 3.25*4)

mean(mat_rules_subj)
sd(mat_rules_subj)

mean(cat_rules_subj)
sd(cat_rules_subj)

subjects=c(1,2,3,4,5,6,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27)
df1=data.frame()
for (i in 1:length(subjects)){
  
  df1 = rbind(df1, c(mat_rules_subj[i],1,subjects[i]))
  df1 = rbind(df1, c(cat_rules_subj[i],0,subjects[i]))
  
}
names(df1)=c('num','mat','subj')
m1 = glmer(num~mat + (1|subj),data=df1,family=poisson)
summary(m1)

### Time to criterion
library(coxme)

mat_tc1=c(4, 34, 4, 11, 13, 6, 6, 6, 5, 4, 5, 5, 6, 12, 5, 5, 4, 7, 4, 4, 4, 3, 4, 5, 6, 5, 5, 6, 4, 3, 5, 8, 6, 7, 5, 3, 3, 4, 4, 9, 3, 6, 6, 13, 3, 3, 4, 3, 3, 4, 6, 6, 6, 10, 5, 4, 4, 5, 4, 3, 4, 3, 6, 6, 4, 5, 5, 6, 6, 3, 19, 5, 8, 8, 7, 8, 7, 6, 5, 6, 7, 4, 5, 8, 4, 6, 11, 4, 12, 6, 7, 7, 6, 6, 4, 4, 9, 16, 6, 6, 8, 4, 17, 6, 7, 5, 9, 5, 5, 4, 5, 9, 6, 4, 8, 13, 24, 5, 6, 3, 4, 9, 8, 4, 5, 10, 5, 6, 5, 5, 5, 6, 5, 4, 11, 4, 6, 5, 5, 6, 7, 5, 6, 5, 33, 6, 6, 4, 5, 9, 6, 5, 3, 4, 5, 5, 10, 6, 7, 5, 4, 4, 3, 9, 5, 7, 5, 5, 3, 4, 5, 6, 5, 4, 3, 6, 5, 7, 9, 5, 4, 4, 4, 6, 6, 4, 3, 5, 6, 4, 6, 4, 5, 5, 3, 5, 4, 4, 6, 5, 15, 7, 6, 7, 3, 4, 4, 11, 4, 5, 4, 3, 10, 5, 4, 7, 5, 4, 9, 8, 5, 7, 7, 3, 6, 4, 6, 3, 6, 6, 4, 6, 4, 6, 10, 7, 5, 12, 3, 9, 5, 11, 3, 6, 5, 4, 9, 5, 4, 4, 7, 11, 24, 5, 6, 4, 7, 4, 5, 3, 5, 4, 13, 4, 4, 8, 27, 12, 6, 7, 11, 7, 24, 6, 9, 8, 6, 4, 17, 3, 5, 5, 5, 10, 6, 5, 4, 4, 9, 6, 8, 3, 14, 4, 8, 31, 14, 41, 8, 5, 39, 5, 6, 5, 4, 6, 6, 7, 3, 5, 4, 5, 5, 4, 11, 5, 6, 5, 4, 6, 3, 4, 4, 4, 3, 5, 15, 4, 9, 7, 6, 6, 10, 5, 5, 4, 5, 8, 6, 9, 4, 6, 4, 11, 4, 4, 6, 4, 4, 5, 4, 10, 5, 5, 5, 4, 6, 5, 5, 4, 4, 7, 16, 7, 6, 8, 4, 10, 7, 15, 7, 6, 6, 9, 16, 6, 4, 7, 7, 5, 4, 5, 10, 5, 5, 4, 3, 8, 4, 5, 5, 6)
mat_tc2=c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
mat_tc3=c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27)

cat_tc1=c(20, 6, 15, 5, 5, 12, 8, 8, 9, 14, 6, 10, 6, 9, 5, 5, 21, 5, 35, 17, 19, 7, 11, 12, 17, 12, 10, 12, 15, 7, 5, 10, 11, 6, 24, 6, 12, 11, 20, 12, 9, 9, 10, 19, 10, 5, 9, 10, 12, 19, 10, 11, 8, 11, 10, 6, 20, 17, 16, 6, 13, 15, 7, 15, 7, 13, 13, 18, 35, 8, 6, 8, 6, 15, 18, 8, 11, 13, 13, 5, 10, 8, 7, 8, 5, 7, 9, 12, 5, 18, 21, 5, 10, 6, 11, 11, 9, 20, 40, 6, 18, 9, 9, 7, 13, 27, 11, 6, 12, 7, 12, 10, 13, 5, 7, 28, 14, 14, 19, 7, 24, 18, 4, 13, 11, 20, 11, 7, 10, 7, 6, 6, 8, 6, 13, 4, 7, 14, 6, 8, 13, 7, 15, 5, 5, 5, 8, 15, 5, 9, 16, 8, 9, 24, 17, 25, 43, 8, 20, 18, 10, 16, 13, 32, 6, 12, 20, 14, 10, 9, 17, 7, 21, 10, 5, 12, 19, 6, 8, 10, 5, 5, 8, 5, 45, 29, 15, 16, 21, 7, 5, 7, 11, 6, 5, 6, 17, 10, 5, 5, 4, 8, 7, 11, 11, 11, 6, 7, 16, 5, 18, 5, 7, 10, 12, 18, 9, 5, 9, 11, 11, 5, 7, 6, 8, 10, 53, 5, 9, 11, 45, 23, 5, 6, 8, 8, 5, 9, 16, 8, 8, 6, 14, 7)
cat_tc2=c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
cat_tc3=c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 8, 8, 8, 8, 8, 8, 8, 8, 8, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27)

mean(mat_tc1)
sd(mat_tc1)

mean(cat_tc1)
sd(cat_tc1)

df2=data.frame()
for (j in 1:length(mat_tc1)){
  df2 = rbind(df2, c(mat_tc1[j],mat_tc2[j],mat_tc3[j]))
}
for (k in 1:length(cat_tc1)){
  df2 = rbind(df2, c(cat_tc1[k],cat_tc2[k],cat_tc3[k]))
}
names(df2)=c('num','mat','subj')
df2$mat <- factor(df2$mat, levels=c("0","1"))
df2 <- within(df2, mat <- relevel(mat, ref = "0"))
m2 = coxme(Surv(num,rep(1,(length(mat_tc1)+length(cat_tc1)))) ~ 1 + mat + (1|subj),data=df2)
summary(m2)
